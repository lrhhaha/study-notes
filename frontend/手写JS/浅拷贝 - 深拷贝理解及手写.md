
# 零、栈内存与堆内存

在JS中，存储空间可分为栈内存与堆内存，可以简单理解为：原始值存放在栈内存中，引用值存放在堆内存中。

当我们声明一个变量，赋值为原始值的时候，JS引擎会开辟一个栈内存空间，把原始值存放在栈内存空间中，并且使变量指向这个栈内存空间的地址。




```javascript
// 浅拷贝
// 1. 传进去的必须是对象或数组，返回返回实参
// 2. 对自身可枚举的属性进行拷贝（但不包含symbol属性）
// 3. 如果需要拷贝symbol属性，需要手动处理，判断此symbol属性是否是可枚举的。

function clone(origin) {
  if (origin instanceof Array) {
    // return origin.slice(0)
    // return origin.map(item => item)
    return [...origin];
  } else if (Object.prototype.toString.call(origin) === '[object Object]') {
    // return { ...origin }
    // return Object.assign({}, origin)

    const result = {}

    // 遍历自身及原型链上的可枚举属性
    for (let key in origin) {
      // 是自身属性才进行克隆
      if (Object.hasOwn(origin, key)) {
        result[key] = origin[key]
      }
    }

    // 注：以下是对symbol属性进行处理，一般无需使用到，根据业务进行调整
    // 获取自身所有symbol属性（包括不可枚举的）
    const symbolKeys = Object.getOwnPropertySymbols(origin);
    // 判断属性的可枚举性
    for (let key of symbolKeys) {
      const descriptor = Reflect.getOwnPropertyDescriptor(origin, key)
      // 是可枚举属性才进行克隆
      if (descriptor.enumerable) {
        result[key] = origin[key]
      }
    }

    return result;
  }
  return origin;
}
```






```javascript
function deepClone(origin, visited = new WeakMap()) {

  // 原始值直接返回, 函数不作处理，直接返回
  if (origin === null || typeof origin !== 'object') return origin

  if (visited.has(origin)) return visited.get(origin)

  // 某些内置对象，这里只举几个例子
  if (origin instanceof Date) return new Date(origin)
  if (origin instanceof RegExp) return new RegExp(origin)
  if (origin instanceof Map) return new Map(origin)
  if (origin instanceof Set) return new Set(origin)

  // 处理数组
  if (origin instanceof Array) {
    const result = []
    visited.set(origin, result)

    origin.forEach((item, index) => {
      result[index] = deepClone(item)
    })
    return result
  }

  // 处理对象
  if (Object.prototype.toString.call(origin) === '[object Object]') {
    const result = {}
    visited.set(origin, result)
    
    for (let key in origin) {
      if (Object.hasOwn(origin, key)) {
        result[key] = deepClone(origin[key])
      }
    }
    return result
  }

  // 更多未处理的内置对象，暂不处理，直接返回
  return origin
}
```
