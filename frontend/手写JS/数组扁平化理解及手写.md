
## ES5实现

```javascript
// 支持自定义扁平化深度控制
// 处理空数组和undefined元素

function flat(array, deep) {
  if (!Array.isArray(array)) {
    throw new TypeError("arguments[0] must be an array");
  }

  deep = deep ?? Infinity;

  const result = [];

  for (let i = 0; i < array.length; i++) {
    const item = array[i];

    if (Array.isArray(item) && deep > 0) {
      // flat的返回值是一个扁平化后的数组
      const newArr = flat(item, deep - 1);
      newArr.forEach((element) => result.push(element));
    } else {
      item !== undefined && result.push(item);
    }
  }

  return result;
}

console.log(flat([1, undefined, [2, 3], [4, []]], 2));
```

## ES6实现

#### 基础实现

```javascript
function flat(array, deep = Infinity) {

  if (!Array.isArray) {
    throw new TypeError('arguments[0] must be an array')
  }

  let result = []

  if (deep > 0 && array.some(item => Array.isArray(item))) {

    array.forEach(item => {
      if (Array.isArray(item)) {
        result.push(...flat(item, deep - 1))
      } else {
        result.push(item)
      }
    })

  } else {

    result = result.concat(array)

  }

  return result
}

console.log(flat([1, [2, 3], [4, [5, 6]]], 2));

```

#### 挑战测试 实现

##### reduce版本：函数式编程风格，支持深度控制

##### spread版本：利用扩展运算符，简洁但只能完全扁平化

##### 迭代版本：使用栈结构，避免递归调用栈限制