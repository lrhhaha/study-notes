```javascript
const obj = {
  show: true,
  users: [
    {
      name: "小明",
      url: "url1",
    },
    {
      name: "小红",
      url: "url2",
    },
  ],
};

const str = `
<ul>
  <% if (obj.show) { %>
    <% for (var i = 0; i < obj.users.length; i++) { %>
      <li>
        <a href="<%= obj.users[i].url %>">
          <%= obj.users[i].name %>
        </a>
      </li>
    <% } %>
  <% } else { %>
    <p>不展示列表</p>
  <% } %>
</ul>
`;
```

```javascript
html = "";
html += "<ul>";

if (obj.show) {
  for (var i = 0; i < obj.users.length; i++) {
    html += '<li><a href="';
    html += obj.users[i].url;
    html += '">';
    html += obj.users[i].name;
    html += "</a></li>";
  }
} else {
  html += "<p>不展示列表</p>";
}

html += "</ul>";

console.log(html) // '<ul><li><a href="url1">小明</a></li><li><a href="url2">小红</a></li></ul>'

// 将html作为innerHTML插入，生成真实DOM
container.innerHTML = html;
```
根据以下规则进行替换：
- 将 %> 替换成  html+='
- 将 <% 替换成 ';
- 将 <%=xxx%> 替换成 ';html+=xxx;html+='

```javascript
const str = `
html += '<ul>
  '; if (obj.show) { html+='
    '; for (var i = 0; i < obj.users.length; i++) { html+='
      <li>
        <a href=" ';html+= obj.users[i].url ;html+='">
          ';html+= obj.users[i].name ;html+='
        </a>
      </li>
    '; } html+='
  '; } else { html+='
    <p>不展示列表</p>
  '; } html+='
</ul>
';
`;
```
值得注意的是，上述字符串中的换行是需要去掉的，否则转换成代码时会报错。但这里为了与原字符串模版作对比，才没有将换行去掉。后续操作中将会把字符串中的换行替换掉。

现在我们将使用String.prototype.replace配合正则表达式的方式，对字符串模版中的特殊符号进行替换。

```javascript
const reg1 = /[\r\t\n]/g; // 匹配出全部的换行
const reg2 = /<%=(.*?)%>/g; // 匹配出所有形如：<% xxx %> 的子串
const reg3 = /<%/g; // 匹配出全部的 <%
const reg4 = /%>/g; // 匹配出全部的 %>

console.log('a<%b<%c'.replace(/<%/g, '+')) // 'a+b+c'
```


然后我们需要将“代码字符串”变成真正的代码，让它运行起来，它才能帮我们生成对应的innerHTML文本。
字符串转代码，我们可以联想到[Function](https://developer.mozilla.org/zh-CN/docs/Web/JavaScript/Reference/Global_Objects/Function/Function)构造函数。


