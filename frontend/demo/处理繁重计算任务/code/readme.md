# 项目运行
此项目基于vite@7，需要Node版本20.19+。



# 具体方案
本demo使用了两种方案实现保证网页性能的前提下，运行繁重的js计算：
1. web worker
2. requestIdleCallback

## web worker
使用web worker创建一个工作线程，运行繁重的计算。

优点：
1. 独立的工作线程，不会阻塞JS主线程，不影响页面渲染。
2. 使用方式相对简单，使用Worker构造函数创建，直接编写同步的繁重计算代码，无需考虑JS线程阻塞问题。

缺点：
1. 主线程与工作线程需通过特殊API进行信息通信。
2. 线程创建，信息通信耗费需要额外的时间成本，在本例子中，其他时间成本约为计算成本的4倍。

## requestIdleCallback
使用浏览器空闲时间进行繁重计算。

优点:
1. 代码运行在JS主线程中，能共享状态，无需考虑通信等问题。
2. 只在浏览器空闲时间进行计算，运用恰当则不会影响应用性能。

缺点：
1. 使用方式复杂，需编写任务队列，及编写函数处理任务
2. 需手动将繁重任务拆分为多个小任务，防止单个任务耗时过长阻塞JS主线程。
3. 遇到其他任务占用JS线程时，可能浏览器长时间处于繁忙状态，没有空闲时间处理任务队列。
4. 不能保证一定不会阻塞JS主线程。

# 性能分析
两种方案的性能分析（火焰图）文件，见项目根目录的“性能分析”文件夹。

# 总结
web worker 和 requestIdleCallback 都是处理繁重任务的好方式。

如果最求极致性能，web worker会是更好的选择。

requestIdleCallback的优点则在于运行环境是JS主线程，无需具备工作线程的知识也能使用。
